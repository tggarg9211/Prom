<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Night of Promises</title>
    <style>
        :root {
            --bg-color: #02040a;
            --star-white: #f8f9fa;
            --accent-glow: rgba(180, 160, 255, 0.4);
            --text-main: #d1d1d1;
            --font-serif: "Times New Roman", Times, serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body, html {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-serif);
            letter-spacing: 0.05em;
        }

        #canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
        }

        #constellation {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 2;
            pointer-events: none;
            opacity: 0;
            transition: opacity 3s ease;
        }

        #audio-toggle {
            position: fixed;
            top: 25px;
            right: 25px;
            z-index: 100;
            font-size: 9px;
            text-transform: uppercase;
            opacity: 0.3;
            letter-spacing: 0.2em;
        }

        .screen {
            position: fixed;
            inset: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            opacity: 0;
            visibility: hidden;
            transition: opacity 2.5s ease;
            padding: 40px;
            text-align: center;
        }

        .screen.active {
            opacity: 1;
            visibility: visible;
        }

        #intro-text {
            font-size: 1.1rem;
            line-height: 1.8;
            font-style: italic;
            max-width: 80%;
        }

        .promise-star {
            position: absolute;
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 10px var(--star-white);
            cursor: pointer;
            z-index: 15;
            transition: transform 0.6s cubic-bezier(0.2, 0, 0.2, 1), box-shadow 1s ease;
        }

        .promise-star.opened {
            box-shadow: 0 0 25px 5px var(--accent-glow);
            transform: scale(1.4);
        }

        #promise-overlay {
            position: fixed;
            inset: 0;
            background: rgba(2, 4, 10, 0.98);
            z-index: 50;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }

        #promise-content {
            font-size: 1.2rem;
            max-width: 320px;
            line-height: 1.7;
            margin-bottom: 40px;
            white-space: pre-line;
        }

        .close-hint {
            font-size: 0.65rem;
            text-transform: uppercase;
            opacity: 0.3;
            letter-spacing: 0.3em;
        }

        #seal-area {
            width: 120px;
            height: 120px;
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            margin: 0 auto;
        }

        .pulse-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 1px solid var(--accent-glow);
            animation: pulse 3s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.4; }
            100% { transform: scale(1.6); opacity: 0; }
        }

        #final-line {
            font-size: 1.2rem;
            opacity: 0;
            transition: opacity 3s ease;
            max-width: 280px;
            line-height: 1.6;
        }
    </style>
</head>
<body onclick="handleGlobalClick()">

    <div id="audio-toggle">Sound: Muted</div>
    <audio id="ambient-track" loop pre-load="auto">
        <source src="ambient.mp3" type="audio/mpeg">
    </audio>

    <canvas id="canvas"></canvas>
    <canvas id="constellation"></canvas>

    <div class="screen active" id="screen-intro">
        <div id="intro-text">
            <p id="line-1" style="opacity: 0;">Some words are too important to be spoken casuallyâ€¦</p>
            <p id="line-2" style="opacity: 0; margin-top: 25px;">Tonight, I make you promises.</p>
            <p id="tap-to-begin" style="opacity: 0; margin-top: 50px; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.4em;">Tap anywhere</p>
        </div>
    </div>

    <div class="screen" id="screen-sky">
        <div id="sky-instruction" style="position:absolute; bottom:8vh; font-size: 0.65rem; opacity:0.4; text-transform:uppercase; letter-spacing: 0.2em;">Choose a star</div>
    </div>

    <div class="screen" id="screen-seal">
        <div>
            <p style="margin-bottom: 50px; font-style: italic; opacity: 0.8;">Now our promises belong to the same sky.</p>
            <div id="seal-trigger" style="display: inline-block; cursor: pointer;">
                <div id="seal-area">
                    <div class="pulse-ring"></div>
                    <div style="font-size: 0.6rem; opacity: 0.5; letter-spacing: 0.2em;">HOLD</div>
                </div>
                <p style="margin-top: 30px; font-size: 0.65rem; opacity: 0.3; text-transform: uppercase;">Press and hold to seal</p>
            </div>
        </div>
    </div>

    <div class="screen" id="screen-final">
        <div id="final-line"></div>
    </div>

    <div id="promise-overlay" onclick="closePromise()">
        <div id="promise-content"></div>
        <div class="close-hint">Tap to release</div>
    </div>

    <script>
        const promises = [
            "Mine favourite is yours favourite too, you.",
            "I will always protect you from everything that is bad for you, even me, when I will be bad for you ðŸ˜‚.",
            "Tu tension mat liya kr...\n'MAIN HUN NA.'",
            "You will get there.\nBut right now you are here.\nAnd here is beautiful.",
            "Staying will never be our flaw.\nLoving will be our courage.",
            "If there is even a slight chance at getting something that will make you happy, I will risk it.\nLife is too short and happiness is too rare :)",
            "â€œYou and I were always just a daydream I took too far... and maybe I'll take it even farther.â€"
        ];

        let state = "intro";
        let openedCount = 0;
        let audioStarted = false;
        const starElements = [];
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let width, height;

        function initCanvas() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', initCanvas);
        initCanvas();

        const particles = Array.from({ length: 90 }, () => ({
            x: Math.random() * width,
            y: Math.random() * height,
            size: Math.random() * 1.2,
            speed: Math.random() * 0.15 + 0.05
        }));

        function drawParticles() {
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = "white";
            particles.forEach(p => {
                p.y -= p.speed;
                if (p.y < 0) p.y = height;
                ctx.globalAlpha = 0.2;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
            });
            requestAnimationFrame(drawParticles);
        }
        drawParticles();

        function handleGlobalClick() {
            if (state === "intro") {
                state = "intro-sequence";
                startSequence();
            }
        }

        function startSequence() {
            setTimeout(() => { document.getElementById('line-1').style.opacity = 1; }, 500);
            setTimeout(() => { document.getElementById('line-2').style.opacity = 1; }, 3500);
            setTimeout(() => {
                transitionTo('screen-sky');
                createStars();
            }, 7500);
        }

        function createStars() {
            const container = document.getElementById('screen-sky');
            promises.forEach((text, i) => {
                const star = document.createElement('div');
                star.className = 'promise-star';
                star.style.left = `${15 + Math.random() * 70}%`;
                star.style.top = `${15 + Math.random() * 60}%`;
                
                star.onclick = (e) => {
                    e.stopPropagation();
                    if (!audioStarted) {
                        const audio = document.getElementById('ambient-track');
                        audio.volume = 0;
                        audio.play();
                        let vol = 0;
                        const fadeIn = setInterval(() => {
                            if (vol < 0.35) { vol += 0.05; audio.volume = vol; }
                            else { clearInterval(fadeIn); }
                        }, 200);
                        document.getElementById('audio-toggle').innerText = "Sound: On";
                        audioStarted = true;
                    }
                    openPromise(text, star);
                };
                container.appendChild(star);
                starElements.push(star);
            });
        }

        function openPromise(text, el) {
            const overlay = document.getElementById('promise-overlay');
            const content = document.getElementById('promise-content');
            content.innerHTML = "";
            overlay.style.display = 'flex';
            
            let i = 0;
            function type() {
                if (i < text.length) {
                    content.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(type, 45);
                }
            }
            type();

            if (!el.classList.contains('opened')) {
                el.classList.add('opened');
                openedCount++;
            }
        }

        function closePromise() {
            document.getElementById('promise-overlay').style.display = 'none';
            if (openedCount === promises.length) {
                setTimeout(() => {
                    drawConstellation();
                    transitionTo('screen-seal');
                }, 1500);
            }
        }

        function drawConstellation() {
            const c = document.getElementById('constellation');
            const cx = c.getContext('2d');
            c.width = window.innerWidth;
            c.height = window.innerHeight;
            c.style.opacity = "1";
            cx.strokeStyle = "rgba(180, 160, 255, 0.15)";
            cx.lineWidth = 1;
            
            cx.beginPath();
            starElements.forEach((s, idx) => {
                const rect = s.getBoundingClientRect();
                const x = rect.left + 5;
                const y = rect.top + 5;
                if (idx === 0) cx.moveTo(x, y);
                else cx.lineTo(x, y);
            });
            cx.stroke();
        }

        function transitionTo(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        // Seal Logic
        const sealTrigger = document.getElementById('seal-trigger');
        let sealTimer;
        
        const startSeal = () => {
            document.querySelector('.pulse-ring').style.animationDuration = '0.6s';
            sealTimer = setTimeout(() => {
                transitionTo('screen-final');
                showFinalMessage();
            }, 2000);
        };
        
        const endSeal = () => {
            clearTimeout(sealTimer);
            document.querySelector('.pulse-ring').style.animationDuration = '3s';
        };

        sealTrigger.addEventListener('mousedown', startSeal);
        sealTrigger.addEventListener('touchstart', startSeal);
        sealTrigger.addEventListener('mouseup', endSeal);
        sealTrigger.addEventListener('touchend', endSeal);

        function showFinalMessage() {
            const final = document.getElementById('final-line');
            setTimeout(() => {
                final.innerText = "And my most important promise...";
                final.style.opacity = 1;
            }, 2000);

            setTimeout(() => { final.style.opacity = 0; }, 6000);

            setTimeout(() => {
                final.innerText = "No matter where life takes us... you will never walk alone.";
                final.style.opacity = 1;
            }, 9500);
        }

        // Initial hint
        setTimeout(() => { document.getElementById('tap-to-begin').style.opacity = 0.4; }, 2000);
    </script>
</body>
</html>
